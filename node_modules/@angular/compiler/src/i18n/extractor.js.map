{"version":3,"file":"extractor.js","sourceRoot":"","sources":["../../../../../modules/@angular/compiler/src/i18n/extractor.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\n\n/**\n * Extract i18n messages from source code\n */\nimport {ViewEncapsulation} from '@angular/core';\n\nimport {analyzeAndValidateNgModules, extractProgramSymbols} from '../aot/compiler';\nimport {StaticAndDynamicReflectionCapabilities} from '../aot/static_reflection_capabilities';\nimport {StaticReflector, StaticReflectorHost} from '../aot/static_reflector';\nimport {AotSummaryResolver, AotSummaryResolverHost} from '../aot/summary_resolver';\nimport {CompileDirectiveMetadata} from '../compile_metadata';\nimport {CompilerConfig} from '../config';\nimport {DirectiveNormalizer} from '../directive_normalizer';\nimport {DirectiveResolver} from '../directive_resolver';\nimport {CompileMetadataResolver} from '../metadata_resolver';\nimport {HtmlParser} from '../ml_parser/html_parser';\nimport {InterpolationConfig} from '../ml_parser/interpolation_config';\nimport {NgModuleResolver} from '../ng_module_resolver';\nimport {ParseError} from '../parse_util';\nimport {PipeResolver} from '../pipe_resolver';\nimport {Console} from '../private_import_core';\nimport {DomElementSchemaRegistry} from '../schema/dom_element_schema_registry';\nimport {createOfflineCompileUrlResolver} from '../url_resolver';\n\nimport {I18NHtmlParser} from './i18n_html_parser';\nimport {MessageBundle} from './message_bundle';\n\nexport interface ExtractorOptions {\n  includeFilePattern?: RegExp;\n  excludeFilePattern?: RegExp;\n}\n\n/**\n * The host of the Extractor disconnects the implementation from TypeScript / other language\n * services and from underlying file systems.\n */\nexport interface ExtractorHost extends StaticReflectorHost, AotSummaryResolverHost {\n  /**\n   * Loads a resource (e.g. html / css)\n   */\n  loadResource(path: string): Promise<string>;\n}\n\nexport class Extractor {\n/**\n * @param {?} options\n * @param {?} host\n * @param {?} staticReflector\n * @param {?} messageBundle\n * @param {?} metadataResolver\n */\nconstructor(\nprivate options: ExtractorOptions,\npublic host: ExtractorHost,\nprivate staticReflector: StaticReflector,\nprivate messageBundle: MessageBundle,\nprivate metadataResolver: CompileMetadataResolver) {}\n/**\n * @param {?} rootFiles\n * @return {?}\n */\nextract(rootFiles: string[]): Promise<MessageBundle> {\n    const /** @type {?} */ programSymbols = extractProgramSymbols(this.staticReflector, rootFiles, this.options);\n    const {ngModuleByPipeOrDirective, files, ngModules} =\n        analyzeAndValidateNgModules(programSymbols, this.options, this.metadataResolver);\n    return Promise\n        .all(ngModules.map(\n            ngModule => this.metadataResolver.loadNgModuleDirectiveAndPipeMetadata(\n                ngModule.type.reference, false)))\n        .then(() => {\n          const /** @type {?} */ errors: ParseError[] = [];\n\n          files.forEach(file => {\n            const /** @type {?} */ compMetas: CompileDirectiveMetadata[] = [];\n            file.directives.forEach(directiveType => {\n              const /** @type {?} */ dirMeta = this.metadataResolver.getDirectiveMetadata(directiveType);\n              if (dirMeta && dirMeta.isComponent) {\n                compMetas.push(dirMeta);\n              }\n            });\n            compMetas.forEach(compMeta => {\n              const /** @type {?} */ html = compMeta.template.template;\n              const /** @type {?} */ interpolationConfig =\n                  InterpolationConfig.fromArray(compMeta.template.interpolation);\n              errors.push(\n                  ...this.messageBundle.updateFromTemplate(html, file.srcUrl, interpolationConfig));\n            });\n          });\n\n          if (errors.length) {\n            throw new Error(errors.map(e => e.toString()).join('\\n'));\n          }\n\n          return this.messageBundle;\n        });\n  }\n/**\n * @param {?} host\n * @param {?} options\n * @return {?}\n */\nstatic create(host: ExtractorHost, options: ExtractorOptions):\n      {extractor: Extractor, staticReflector: StaticReflector} {\n    const /** @type {?} */ htmlParser = new I18NHtmlParser(new HtmlParser());\n\n    const /** @type {?} */ urlResolver = createOfflineCompileUrlResolver();\n    const /** @type {?} */ staticReflector = new StaticReflector(host);\n    StaticAndDynamicReflectionCapabilities.install(staticReflector);\n\n    const /** @type {?} */ config = new CompilerConfig({\n      genDebugInfo: false,\n      defaultEncapsulation: ViewEncapsulation.Emulated,\n      logBindingUpdate: false,\n      useJit: false\n    });\n\n    const /** @type {?} */ normalizer = new DirectiveNormalizer(\n        {get: (url: string) => host.loadResource(url)}, urlResolver, htmlParser, config);\n    const /** @type {?} */ elementSchemaRegistry = new DomElementSchemaRegistry();\n    const /** @type {?} */ resolver = new CompileMetadataResolver(\n        new NgModuleResolver(staticReflector), new DirectiveResolver(staticReflector),\n        new PipeResolver(staticReflector), new AotSummaryResolver(host, staticReflector, options),\n        elementSchemaRegistry, normalizer, staticReflector);\n\n    // TODO(vicb): implicit tags & attributes\n    const /** @type {?} */ messageBundle = new MessageBundle(htmlParser, [], {});\n\n    const /** @type {?} */ extractor = new Extractor(options, host, staticReflector, messageBundle, resolver);\n    return {extractor, staticReflector};\n  }\n}\n\nfunction Extractor_tsickle_Closure_declarations() {\n /** @type {?} */\nExtractor.prototype.options;\n /** @type {?} */\nExtractor.prototype.host;\n /** @type {?} */\nExtractor.prototype.staticReflector;\n /** @type {?} */\nExtractor.prototype.messageBundle;\n /** @type {?} */\nExtractor.prototype.metadataResolver;\n}\n\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}